<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"></script>
    <style>
        .bar:hover {
            transition-duration: 0.8s;
            opacity: 0.3;
        }
        div{
            border:1px solid red;
            display:flex;flex-direction: row;justify-content: center;
        }
    </style>
    <div></div>
</head>

<body>
    <script>
        //console.log(fetchData());
        fetchData();
        function fetchData() {
            let url = "https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json";
            fetch(url).then(response => response.json()).then(data => {
                console.log(data.data);
                visualizeData(data.data);
            });
            //data.data becuz: first data is the argument of "then", second data is a property in the returned object, this property is an array
            /*from fcc
            The first line is the one that makes the request. So, fetch(URL) makes a GET request to the URL specified. The method returns a Promise.
    
            After a Promise is returned, if the request was successful, the then method is executed, which takes the response and converts it to JSON format.
    
            The then method also returns a Promise, which is handled by the next then method.
            */
        }

        function visualizeData(dataset) {
            /*let dataset = [
                [ "1947-01-01", 243.1 ],
                [ "1947-04-01", 246.3 ],
                [ "1947-07-01", 250.1 ],
                [ "1947-10-01", 260.3 ],
                [ "1948-01-01", 266.2 ],
                [ "1948-04-01", 272.9 ],
                [ "1948-07-01", 279.5 ],
                [ "1948-10-01", 280.7 ],
                [ "1949-01-01", 275.4 ],
                [ "1949-04-01", 271.7 ],
                [ "1949-07-01", 273.3 ],
            ];*/

            const w = 800;
            const h = 500;
            const padding = 10;
            const barWidth = 3;

            //adding svg tag to the body with height and width
            const svg = d3.selectAll("div").append("svg").attr("width", w).attr("height", h);

            //adding scales
            //const xScale = d3.scaleLinear().domain([0, d3.max(dataset, (d)=>d[0].slice(0,4))]).range([padding, w-padding]);
            var xScale = d3.scaleTime()
                .domain([
                    d3.min(dataset, (d) => new Date(d[0])),
                    d3.max(dataset, (d) => new Date(d[0]))
                ])
                .range([padding, w - padding]);
            const yScale = d3.scaleLinear().domain([0, d3.max(dataset, (d) => d[1])]).range([(h - padding), padding]);



            //adding rect svg tags using the dataset
            svg.selectAll("rect")
                .data(dataset)
                .enter()
                .append("rect")
                .attr("x", (d) => xScale(new Date(d[0])))
                .attr("y", (d) => yScale(d[1]))
                .attr("width", barWidth)
                .attr("height", (d) => h-padding-yScale(d[1]))
                .attr("fill", "navy")
                .attr("class", "bar")
                .append("title").text((d) => (d[0] + "\n" + "$" + d[1] + " Billion"));

                //adding xAxis
                const xAxis = d3.axisBottom(xScale);
                svg.append("g")
                .attr("transform", "translate(0, " + (h-padding) + ")")//we'll move the xAxis to the bottom of the svg
                .call(xAxis);

               //adding yAxis
               const yAxis = d3.axisLeft(yScale);
                svg.append("g")
                .attr("transform", "translate(" + padding + ", 0)")//we'll move the yAxis to the extreme left of the svg
                .call(yAxis);                 


        }
    </script>
</body>

</html>