<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.min.js"></script>
    <style>
        .bar:hover {
            transition-duration: 0s;
            opacity: 0.3;
        }

        div {
            border: 1px solid #efefef;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }
    </style>
    <div></div>
</head>

<body>
    <script>
        //console.log(fetchData());
        fetchData();
        function fetchData() {
            let url = "https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json";
            fetch(url).then(response => response.json()).then(data => {
                console.log(data.data);
                visualizeData(data.data);
            });
            //data.data becuz: first data is the argument of "then", second data is a property in the returned object, this property is an array
            /*from fcc
            The first line is the one that makes the request. So, fetch(URL) makes a GET request to the URL specified. The method returns a Promise.
    
            After a Promise is returned, if the request was successful, the then method is executed, which takes the response and converts it to JSON format.
    
            The then method also returns a Promise, which is handled by the next then method.
            */
        }

        function visualizeData(dataset) {
            /*let dataset = [
                [ "1947-01-01", 243.1 ],
                [ "1947-04-01", 246.3 ],
                [ "1947-07-01", 250.1 ],
                [ "1947-10-01", 260.3 ],
                [ "1948-01-01", 266.2 ],
                [ "1948-04-01", 272.9 ],
                [ "1948-07-01", 279.5 ],
                [ "1948-10-01", 280.7 ],
                [ "1949-01-01", 275.4 ],
                [ "1949-04-01", 271.7 ],
                [ "1949-07-01", 273.3 ],
            ];*/

            const w = 800;
            const h = 500;
            const padding = 50;
            const barWidth = 3;

            //adding svg tag to the body with height and width
            const svg = d3.selectAll("div").append("svg").attr("width", w).attr("height", h);

            //adding scales
            //const xScale = d3.scaleLinear().domain([0, d3.max(dataset, (d)=>d[0].slice(0,4))]).range([padding, w-padding]);
            var xScale = d3.scaleTime()//this method is special to scaling dates
                .domain([
                    d3.min(dataset, (d) => new Date(d[0])),
                    d3.max(dataset, (d) => new Date(d[0]))
                ])//taking min & max of dataset & create two dates of it to be the 'domain' attributes
                .range([padding, w - padding])//teeling d3 that in ui the range of xscaling is from 50 (padding) to 750 (w-padding)
                ;
            const yScale = d3.scaleLinear()//this methid scaleLinear() is used to do scaling for quantitative data
                .domain([0, d3.max(dataset, (d) => d[1])])//telling d3 the min(which is 0 for quantitative data) & max of data to be attributes for 'domain'
                .range([(h - padding), padding])//teeling d3 that in ui the range of yscaling is from 450 (h-padding) to 50 (padding)
                ;



            //adding rect svg tags using the dataset
            svg.selectAll("rect")
                .data(dataset)//linking the dataset to the set of rect elements
                .enter()//if rect elements number is fewer than dataset items, then, new rect elements will be appended automatically with the next line of code
                .append("rect")//here d3 will add new rect elements to have same number as dataset items
                .attr("x", (d) => xScale(new Date(d[0])))//x position is generated by the xScale
                .attr("y", (d) => yScale(d[1]))//x position is generated by the yScale
                .attr("width", barWidth)//setting the width of a bar
                .attr("height", (d) => h - padding - yScale(d[1]))//height bar is generated by yScale and we subtracted it from the height to be right-side-up
                .attr("fill", "navy")
                .attr("class", "bar")//adding a class to the rect elements so that it will have a hover effect
                .append("title").text((d) => (d[0] + "\n" + "$" + d[1] + " Billion"))//adding a title to every rect element that will be displayed once user hover over a bar
                ;

            //adding xAxis
            const xAxis = d3.axisBottom(xScale);//this is the xAxis that we'll use with 'g' element in a call() method
            svg.append("g")
                .attr("transform", "translate(0, " + (h - padding) + ")")//we'll move the xAxis to the bottom of the svg
                .call(xAxis);

            //adding yAxis
            const yAxis = d3.axisLeft(yScale);//this is the yAxis that we'll use with 'g' element in a call() method
            svg.append("g")
                .attr("transform", "translate(" + padding + ", 0)")//we'll move the yAxis to the extreme left of the svg
                .call(yAxis);

            //adding the text 'United States GDP' in top center of the svg element
            svg.append("text")//appending a text element to the svg
                .attr("x", w / 2)//setting the x of text element to start from the center of the svg element
                .attr("y", 0 + padding)//setting the y of text element to start the top of the svg element
                .attr("text-anchor", "middle")//this will make the text perfectly centered (setting only the x is not enough)
                .attr("fill", "black")//setting text color to black
                .style("font-size", "20px")
                .text("United States GDP (Quarterly)");


            //adding the text "More Information: http://www.bea.gov/national/pdf/nipaguid.pdf" in the bottom right of the svg element
            svg.append("text")
                .attr("x", w / 2)
                .attr("y", h - 10)
                .attr("text-anchor", "middle")
                .attr("fill", "#555")
                .attr("font-size", "15px")
                .text("More Information: http://www.bea.gov/national/pdf/nipaguid.pdf")
                ;

        }
    </script>
</body>

</html>